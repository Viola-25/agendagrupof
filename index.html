<!DOCTYPE html>
<html lang="pt-BR" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda de Internato - Enzo Viola</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        .timeline-item:last-child .timeline-line {
            display: none;
        }
        .highlight-search {
            border-color: #fbbf24; /* amber-400 */
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.5);
            transform: scale(1.02);
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        
        <header class="text-center mb-8 relative">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white">Agenda de Internato 2025.2</h1>
            <p class="text-lg sm:text-xl text-indigo-600 dark:text-indigo-400 font-semibold mt-2">Enzo Marques Rodrigues Viola - Grupo F</p>
            
            <!-- Botão de Modo Escuro -->
            <button id="theme-toggle" type="button" class="absolute top-0 right-0 text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5">
                <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
            </button>
        </header>

        <!-- Seção de Busca por Data -->
        <div id="search-section" class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg mb-10 sticky top-4 z-10 border border-gray-200 dark:border-gray-700">
            <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Onde estarei neste dia?</h2>
            <div class="flex flex-col sm:flex-row gap-4 items-center">
                <input type="date" id="date-input" class="w-full sm:w-auto flex-grow p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                <button id="reset-button" class="w-full sm:w-auto bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 font-semibold px-4 py-3 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition">Voltar para Hoje</button>
            </div>
            <div id="search-result" class="mt-4 p-4 rounded-lg hidden transition-all"></div>
        </div>

        <!-- Linha do Tempo dos Rodízios -->
        <div id="schedule-container" class="space-y-4"></div>

        <footer class="text-center mt-12 text-sm text-gray-500 dark:text-gray-400">
            <p>Gerado com base nas planilhas de rodízio do 10º Semestre.</p>
            <p>Sempre confirme as informações com a coordenação.</p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Lógica do Modo Escuro (REVISADA E CORRIGIDA) ---
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
            const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

            // Função para atualizar os ícones com base no tema atual
            const updateThemeIcons = () => {
                if (document.documentElement.classList.contains('dark')) {
                    themeToggleDarkIcon.classList.add('hidden');
                    themeToggleLightIcon.classList.remove('hidden');
                } else {
                    themeToggleDarkIcon.classList.remove('hidden');
                    themeToggleLightIcon.classList.add('hidden');
                }
            };

            // Define o tema inicial ao carregar a página
            if (localStorage.getItem('color-theme') === 'dark' || 
               (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            updateThemeIcons(); // Garante que o ícone correto seja exibido no carregamento

            // Listener para o clique no botão
            themeToggleBtn.addEventListener('click', () => {
                // Alterna a classe 'dark' no elemento <html>
                document.documentElement.classList.toggle('dark');

                // Atualiza o localStorage com a preferência
                if (document.documentElement.classList.contains('dark')) {
                    localStorage.setItem('color-theme', 'dark');
                } else {
                    localStorage.setItem('color-theme', 'light');
                }

                // Atualiza os ícones para refletir a mudança
                updateThemeIcons();
            });


            // --- Dados do Rodízio ---
            const scheduleData = [
                { startDate: '2025-07-07', endDate: '2025-07-20', area: 'Clínica Médica', specialty: 'Radiologia', location: 'Hospital IBCC / Hospital Geral de Carapicuíba (HGC)' },
                { startDate: '2025-07-21', endDate: '2025-08-03', area: 'Clínica Médica', specialty: 'Ambulatório', location: 'PROMOVE' },
                { startDate: '2025-08-04', endDate: '2025-08-17', area: 'Clínica Médica', specialty: 'Ambulatório e Enfermaria', location: 'HFASP' },
                { startDate: '2025-08-18', endDate: '2025-09-07', area: 'Clínica Médica', specialty: 'Ambulatório e Enfermaria', location: 'HMASP' },
                { startDate: '2025-09-08', endDate: '2025-09-28', area: 'Clínica Médica', specialty: 'Ambulatório e Enfermaria', location: 'Hospital Geral de Carapicuíba (HGC)' },
                { startDate: '2025-09-29', endDate: '2025-11-09', area: 'Cirurgia Geral', specialty: 'Ambulatório, Enfermaria e Centro Cirúrgico', location: 'Hospital Estadual da Vila Alpina / AME Barradas' },
                { startDate: '2025-11-10', endDate: '2025-12-21', area: 'Cirurgia Geral', specialty: 'Ambulatório, Enfermaria e Centro Cirúrgico', location: 'Hospital Geral de Carapicuíba (HGC)' },
                { startDate: '2025-12-22', endDate: '2026-01-04', area: 'Férias / Recesso de Fim de Ano', specialty: 'Período de recesso conforme calendário oficial', location: '' }
            ];

            const container = document.getElementById('schedule-container');
            const dateInput = document.getElementById('date-input');
            const resultContainer = document.getElementById('search-result');
            const resetButton = document.getElementById('reset-button');

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const formatDate = (dateString) => {
                const date = new Date(dateString + 'T00:00:00');
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                return `${day}/${month}`;
            };
            
            const renderTimeline = () => {
                container.innerHTML = '';
                scheduleData.forEach((item, index) => {
                    const startDate = new Date(item.startDate + 'T00:00:00');
                    const endDate = new Date(item.endDate + 'T00:00:00');
                    
                    const isCurrent = today >= startDate && today <= endDate;
                    const isPast = today > endDate;
                    const isFuture = today < startDate;
                    const isVacation = item.area.toLowerCase().includes('férias');

                    // --- Lógica da Barra de Progresso ---
                    let progressPercentage = 0;
                    if (isCurrent) {
                        const totalDuration = endDate.getTime() - startDate.getTime();
                        if (totalDuration > 0) {
                            const elapsedDuration = today.getTime() - startDate.getTime();
                            progressPercentage = Math.min(100, (elapsedDuration / totalDuration) * 100);
                        } else {
                            progressPercentage = 100;
                        }
                    } else if (isPast) {
                        progressPercentage = 100;
                    }

                    let cardBg = 'bg-white dark:bg-gray-800';
                    let borderColor = 'border-gray-200 dark:border-gray-700';
                    let textColor = 'text-gray-600 dark:text-gray-400';
                    let iconColor = 'bg-gray-400 dark:bg-gray-500';
                    let ringClass = '';
                    let titleColor = 'text-gray-800 dark:text-gray-100';
                    let countdownHTML = '';
                    let progressHTML = '';

                    if (isVacation) {
                        cardBg = 'bg-green-50 dark:bg-green-900/50'; borderColor = 'border-green-300 dark:border-green-800'; textColor = 'text-green-700 dark:text-green-400'; iconColor = 'bg-green-500'; titleColor = 'text-green-800 dark:text-green-300';
                    }

                    if (isCurrent) {
                        cardBg = 'bg-indigo-50 dark:bg-indigo-900/50'; borderColor = 'border-indigo-500 dark:border-indigo-600'; textColor = 'text-indigo-600 dark:text-indigo-400'; iconColor = 'bg-indigo-500'; ringClass = 'ring-4 ring-indigo-200 dark:ring-indigo-500/50'; titleColor = 'text-indigo-800 dark:text-indigo-300';
                    } else if (isPast) {
                        iconColor = 'bg-gray-300 dark:bg-gray-600';
                        titleColor = 'text-gray-500 dark:text-gray-400';
                        textColor = 'text-gray-400 dark:text-gray-500';
                    } else if (isFuture) {
                        const diffTime = startDate - today;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        countdownHTML = `<div class="text-xs font-bold text-blue-600 dark:text-blue-400 bg-blue-100 dark:bg-blue-900/70 px-2 py-1 rounded-full">Começa em ${diffDays} dia(s)</div>`;
                    }
                    
                    if ((isCurrent || isPast) && !isVacation) {
                         progressHTML = `
                            <div class="mt-4">
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                    <div class="bg-indigo-600 dark:bg-indigo-500 h-2.5 rounded-full" style="width: ${progressPercentage}%"></div>
                                </div>
                            </div>
                         `;
                    }

                    const itemHTML = `
                        <div class="timeline-item flex items-start space-x-4" id="rotation-${index}">
                            <div class="flex flex-col items-center h-full">
                                <div class="w-4 h-4 ${iconColor} rounded-full ${ringClass}"></div>
                                <div class="timeline-line w-0.5 flex-grow bg-gray-300 dark:bg-gray-700 mt-2"></div>
                            </div>
                            <div class="card-content flex-1 pb-8">
                                <div class="p-4 sm:p-5 rounded-xl shadow-md border ${cardBg} ${borderColor} transition-all duration-300">
                                    <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-2 gap-2">
                                        <p class="font-semibold text-lg ${titleColor}">${item.area}</p>
                                        <div class="flex items-center gap-3">
                                            ${countdownHTML}
                                            <p class="text-sm font-medium ${textColor} bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded-md">${formatDate(item.startDate)} - ${formatDate(item.endDate)}</p>
                                        </div>
                                    </div>
                                    ${item.specialty ? `<p class="text-md font-medium mb-1 ${textColor}">${item.specialty}</p>` : ''}
                                    ${item.location ? `<div class="flex items-center mt-3 ${textColor}"><svg class="w-5 h-5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg><span class="text-sm">${item.location}</span></div>` : ''}
                                    ${progressHTML}
                                </div>
                            </div>
                        </div>
                    `;
                    container.innerHTML += itemHTML;
                });
            };
            
            const handleSearch = () => {
                const selectedDateStr = dateInput.value;
                if (!selectedDateStr) return;
                const selectedDate = new Date(selectedDateStr + 'T00:00:00');
                const foundRotation = scheduleData.find(item => {
                    const startDate = new Date(item.startDate + 'T00:00:00');
                    const endDate = new Date(item.endDate + 'T00:00:00');
                    return selectedDate >= startDate && selectedDate <= endDate;
                });
                document.querySelectorAll('.card-content > div').forEach(el => el.classList.remove('highlight-search'));
                if (foundRotation) {
                    const index = scheduleData.indexOf(foundRotation);
                    const formattedDate = selectedDate.toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit', year: 'numeric'});
                    const isVacation = foundRotation.area.toLowerCase().includes('férias');
                    resultContainer.innerHTML = isVacation ? `Em <strong>${formattedDate}</strong>, você estará em período de <strong>${foundRotation.area}</strong>.` : `Em <strong>${formattedDate}</strong>, você estará em <strong>${foundRotation.area}</strong> (${foundRotation.specialty || 'Atividade Principal'}) no local: <strong>${foundRotation.location || 'Não especificado'}</strong>.`;
                    resultContainer.className = `mt-4 p-4 rounded-lg ${isVacation ? 'bg-green-100 dark:bg-green-900/60 text-green-800 dark:text-green-300' : 'bg-indigo-50 dark:bg-indigo-900/60 text-indigo-800 dark:text-indigo-300'}`;
                    resultContainer.classList.remove('hidden');
                    const targetElement = document.getElementById(`rotation-${index}`);
                    if(targetElement) {
                        targetElement.querySelector('.card-content > div').classList.add('highlight-search');
                        targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                } else {
                    resultContainer.innerHTML = 'Nenhum rodízio ou recesso encontrado para esta data.';
                    resultContainer.className = 'mt-4 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200';
                    resultContainer.classList.remove('hidden');
                }
            };

            const resetView = () => {
                dateInput.value = '';
                resultContainer.classList.add('hidden');
                document.querySelectorAll('.card-content > div').forEach(el => el.classList.remove('highlight-search'));
                const currentRotationIndex = scheduleData.findIndex(item => {
                    const startDate = new Date(item.startDate + 'T00:00:00');
                    const endDate = new Date(item.endDate + 'T00:00:00');
                    return today >= startDate && today <= endDate;
                });
                if (currentRotationIndex !== -1) {
                    document.getElementById(`rotation-${currentRotationIndex}`).scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            };

            dateInput.addEventListener('change', handleSearch);
            resetButton.addEventListener('click', resetView);

            renderTimeline();
        });
    </script>

</body>
</html>
